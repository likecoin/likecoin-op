name: "case1"

setup:
  deployer: "0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266"

  accounts:
    - address: "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720"
      likecoin: "10000000000"
    - address: "0x23618e81E3f5cdF7f54C3d65f7FBc0aBf5B21E8f"
      likecoin: "10000000000"
    - address: "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955"
      likecoin: "10000000000"
    - address: "0x976EA74026E726554dB657fA54763abd0C3a0aa9"
      likecoin: "10000000000"
    - address: "0x9965507D1a55bcC2695C58ba16FB37d819B0A4dc"
      likecoin: "10000000000"

steps:
  - name: "newStakePosition"
    calls:
      - type: "newStakePosition"
        bookNFT: "0x1000000000000000000000000000000000000001"
        account: "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720"
        amount: "100000000"
      - type: "newStakePosition"
        bookNFT: "0x1000000000000000000000000000000000000002"
        account: "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955"
        amount: "100000000"

    expectedLogs:
      - eventName: "Transfer"
        address: "0x75c986519a6f4a144520aad0aff7846d17e66175"
      - eventName: "Staked"
        address: "0x227efaea699fde0b11e52d7af81ebf215c5532e1"
      - eventName: "Transfer"
        address: "0x75c986519a6f4a144520aad0aff7846d17e66175"
      - eventName: "Staked"
        address: "0x227efaea699fde0b11e52d7af81ebf215c5532e1"

    expectedState:
      bookPendingRewards:
        "0x1000000000000000000000000000000000000001": "0"
        "0x1000000000000000000000000000000000000002": "0"
      bookStakedAmounts:
        "0x1000000000000000000000000000000000000001": "100000000"
        "0x1000000000000000000000000000000000000002": "100000000"
      userBalance:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720": "9900000000"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955": "9900000000"
      userPendingRewards:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720":
          "0x1000000000000000000000000000000000000001": "0"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955":
          "0x1000000000000000000000000000000000000002": "0"
      userStakedAmounts:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720":
          "0x1000000000000000000000000000000000000001": "100000000"
          "0x1000000000000000000000000000000000000002": "0"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955":
          "0x1000000000000000000000000000000000000001": "0"
          "0x1000000000000000000000000000000000000002": "100000000"

  - name: "increaseStakeToPosition"
    calls:
      - type: "increaseStakeToPosition"
        tokenID: "0"
        account: "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720"
        amount: "100000000"

    expectedLogs:
      - eventName: "Staked"
        address: "0x227efaea699fde0b11e52d7af81ebf215c5532e1"
      - eventName: "RewardClaimed"
        address: "0x227efaea699fde0b11e52d7af81ebf215c5532e1"

    expectedState:
      bookPendingRewards:
        "0x1000000000000000000000000000000000000001": "0"
        "0x1000000000000000000000000000000000000002": "0"
      bookStakedAmounts:
        "0x1000000000000000000000000000000000000001": "200000000"
        "0x1000000000000000000000000000000000000002": "100000000"
      userBalance:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720": "9800000000"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955": "9900000000"
      userPendingRewards:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720":
          "0x1000000000000000000000000000000000000001": "0"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955":
          "0x1000000000000000000000000000000000000002": "0"
      userStakedAmounts:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720":
          "0x1000000000000000000000000000000000000001": "200000000"
          "0x1000000000000000000000000000000000000002": "0"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955":
          "0x1000000000000000000000000000000000000001": "0"
          "0x1000000000000000000000000000000000000002": "100000000"

  - name: "decreaseStakePosition"
    calls:
      - type: "decreaseStakePosition"
        tokenID: "0"
        account: "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720"
        amount: "50000000"

    expectedLogs:
      - eventName: "Unstaked"
        address: "0x227efaea699fde0b11e52d7af81ebf215c5532e1"
      - eventName: "RewardClaimed"
        address: "0x227efaea699fde0b11e52d7af81ebf215c5532e1"

    expectedState:
      bookPendingRewards:
        "0x1000000000000000000000000000000000000001": "0"
        "0x1000000000000000000000000000000000000002": "0"
      bookStakedAmounts:
        "0x1000000000000000000000000000000000000001": "150000000"
        "0x1000000000000000000000000000000000000002": "100000000"
      userBalance:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720": "9850000000"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955": "9900000000"
      userPendingRewards:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720":
          "0x1000000000000000000000000000000000000001": "0"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955":
          "0x1000000000000000000000000000000000000002": "0"
      userStakedAmounts:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720":
          "0x1000000000000000000000000000000000000001": "150000000"
          "0x1000000000000000000000000000000000000002": "0"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955":
          "0x1000000000000000000000000000000000000001": "0"
          "0x1000000000000000000000000000000000000002": "100000000"

  - name: "removeStakePosition"
    calls:
      - type: "removeStakePosition"
        tokenID: "0"
        account: "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720"

    expectedLogs:
      - eventName: "Transfer"
        address: "0x75c986519a6f4a144520aad0aff7846d17e66175"
      - eventName: "RewardClaimed"
        address: "0x227efaea699fde0b11e52d7af81ebf215c5532e1"
      - eventName: "Unstaked"
        address: "0x227efaea699fde0b11e52d7af81ebf215c5532e1"

    expectedState:
      bookPendingRewards:
        "0x1000000000000000000000000000000000000002": "0"
      bookStakedAmounts:
        "0x1000000000000000000000000000000000000002": "100000000"
      userBalance:
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955": "9900000000"
      userPendingRewards:
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955":
          "0x1000000000000000000000000000000000000002": "0"
      userStakedAmounts:
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955":
          "0x1000000000000000000000000000000000000002": "100000000"

  - name: "stake again"
    calls:
      - type: "newStakePosition"
        bookNFT: "0x1000000000000000000000000000000000000001"
        account: "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720"
        amount: "100000000"
      - type: "newStakePosition"
        bookNFT: "0x1000000000000000000000000000000000000001"
        account: "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955"
        amount: "100000000"

    expectedLogs:
      - eventName: "Transfer"
        address: "0x75c986519a6f4a144520aad0aff7846d17e66175"
      - eventName: "Staked"
        address: "0x227efaea699fde0b11e52d7af81ebf215c5532e1"
      - eventName: "Transfer"
        address: "0x75c986519a6f4a144520aad0aff7846d17e66175"
      - eventName: "Staked"
        address: "0x227efaea699fde0b11e52d7af81ebf215c5532e1"

    expectedState:
      bookPendingRewards:
        "0x1000000000000000000000000000000000000001": "0"
        "0x1000000000000000000000000000000000000002": "0"
      bookStakedAmounts:
        "0x1000000000000000000000000000000000000001": "200000000"
        "0x1000000000000000000000000000000000000002": "100000000"
      userBalance:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720": "9900000000"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955": "9800000000"
      userPendingRewards:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720":
          "0x1000000000000000000000000000000000000001": "0"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955":
          "0x1000000000000000000000000000000000000001": "0"
          "0x1000000000000000000000000000000000000002": "0"
      userStakedAmounts:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720":
          "0x1000000000000000000000000000000000000001": "100000000"
          "0x1000000000000000000000000000000000000002": "0"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955":
          "0x1000000000000000000000000000000000000001": "100000000"
          "0x1000000000000000000000000000000000000002": "100000000"

  - name: "depositReward"
    calls:
      - type: "depositReward"
        bookNFT: "0x1000000000000000000000000000000000000001"
        account: "0x23618e81E3f5cdF7f54C3d65f7FBc0aBf5B21E8f"
        amount: "1000"

    expectedLogs:
      - eventName: "RewardDeposited"
        address: "0x227efaea699fde0b11e52d7af81ebf215c5532e1"

    expectedState:
      bookPendingRewards:
        "0x1000000000000000000000000000000000000001": "1000"
        "0x1000000000000000000000000000000000000002": "0"
      bookStakedAmounts:
        "0x1000000000000000000000000000000000000001": "200000000"
        "0x1000000000000000000000000000000000000002": "100000000"
      userBalance:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720": "9900000000"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955": "9800000000"
      userPendingRewards:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720":
          "0x1000000000000000000000000000000000000001": "500"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955":
          "0x1000000000000000000000000000000000000001": "500"
          "0x1000000000000000000000000000000000000002": "0"
      userStakedAmounts:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720":
          "0x1000000000000000000000000000000000000001": "100000000"
          "0x1000000000000000000000000000000000000002": "0"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955":
          "0x1000000000000000000000000000000000000001": "100000000"
          "0x1000000000000000000000000000000000000002": "100000000"

  - name: "claimRewards"
    calls:
      - type: "claimRewards"
        tokenID: "2"
        account: "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720"

    expectedLogs:
      - eventName: "RewardClaimed"
        address: "0x227efaea699fde0b11e52d7af81ebf215c5532e1"

    expectedState:
      bookPendingRewards:
        "0x1000000000000000000000000000000000000001": "500"
        "0x1000000000000000000000000000000000000002": "0"
      bookStakedAmounts:
        "0x1000000000000000000000000000000000000001": "200000000"
        "0x1000000000000000000000000000000000000002": "100000000"
      userBalance:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720": "9900000500"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955": "9800000000"
      userPendingRewards:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720":
          "0x1000000000000000000000000000000000000001": "0"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955":
          "0x1000000000000000000000000000000000000001": "500"
          "0x1000000000000000000000000000000000000002": "0"
      userStakedAmounts:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720":
          "0x1000000000000000000000000000000000000001": "100000000"
          "0x1000000000000000000000000000000000000002": "0"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955":
          "0x1000000000000000000000000000000000000001": "100000000"
          "0x1000000000000000000000000000000000000002": "100000000"

  - name: "stake again"
    calls:
      - type: "newStakePosition"
        bookNFT: "0x1000000000000000000000000000000000000002"
        account: "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720"
        amount: "100000000"
      - type: "newStakePosition"
        bookNFT: "0x1000000000000000000000000000000000000003"
        account: "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720"
        amount: "100000000"
      - type: "newStakePosition"
        bookNFT: "0x1000000000000000000000000000000000000004"
        account: "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720"
        amount: "100000000"
      - type: "depositReward"
        bookNFT: "0x1000000000000000000000000000000000000002"
        account: "0x23618e81E3f5cdF7f54C3d65f7FBc0aBf5B21E8f"
        amount: "1000"
      - type: "depositReward"
        bookNFT: "0x1000000000000000000000000000000000000003"
        account: "0x23618e81E3f5cdF7f54C3d65f7FBc0aBf5B21E8f"
        amount: "1000"
      - type: "depositReward"
        bookNFT: "0x1000000000000000000000000000000000000004"
        account: "0x23618e81E3f5cdF7f54C3d65f7FBc0aBf5B21E8f"
        amount: "1000"

    expectedLogs:
      - eventName: "Transfer"
        address: "0x75c986519a6f4a144520aad0aff7846d17e66175"
      - eventName: "Staked"
        address: "0x227efaea699fde0b11e52d7af81ebf215c5532e1"
      - eventName: "Transfer"
        address: "0x75c986519a6f4a144520aad0aff7846d17e66175"
      - eventName: "Staked"
        address: "0x227efaea699fde0b11e52d7af81ebf215c5532e1"
      - eventName: "Transfer"
        address: "0x75c986519a6f4a144520aad0aff7846d17e66175"
      - eventName: "Staked"
        address: "0x227efaea699fde0b11e52d7af81ebf215c5532e1"
      - eventName: "RewardDeposited"
        address: "0x227efaea699fde0b11e52d7af81ebf215c5532e1"
      - eventName: "RewardDeposited"
        address: "0x227efaea699fde0b11e52d7af81ebf215c5532e1"
      - eventName: "RewardDeposited"
        address: "0x227efaea699fde0b11e52d7af81ebf215c5532e1"

    expectedState:
      bookPendingRewards:
        "0x1000000000000000000000000000000000000001": "500"
        "0x1000000000000000000000000000000000000002": "1000"
        "0x1000000000000000000000000000000000000003": "1000"
        "0x1000000000000000000000000000000000000004": "1000"
      bookStakedAmounts:
        "0x1000000000000000000000000000000000000001": "200000000"
        "0x1000000000000000000000000000000000000002": "200000000"
        "0x1000000000000000000000000000000000000003": "100000000"
        "0x1000000000000000000000000000000000000004": "100000000"
      userBalance:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720": "9600000500"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955": "9800000000"
      userPendingRewards:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720":
          "0x1000000000000000000000000000000000000001": "0"
          "0x1000000000000000000000000000000000000002": "500"
          "0x1000000000000000000000000000000000000003": "1000"
          "0x1000000000000000000000000000000000000004": "1000"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955":
          "0x1000000000000000000000000000000000000001": "500"
          "0x1000000000000000000000000000000000000002": "500"
      userStakedAmounts:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720":
          "0x1000000000000000000000000000000000000001": "100000000"
          "0x1000000000000000000000000000000000000002": "100000000"
          "0x1000000000000000000000000000000000000003": "100000000"
          "0x1000000000000000000000000000000000000004": "100000000"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955":
          "0x1000000000000000000000000000000000000001": "100000000"
          "0x1000000000000000000000000000000000000002": "100000000"
          "0x1000000000000000000000000000000000000003": "0"
          "0x1000000000000000000000000000000000000004": "0"

  - name: "claimAllRewards"
    calls:
      - type: "claimAllRewards"
        account: "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720"

    expectedLogs:
      - eventName: "AllRewardClaimed"
        address: "0x227efaea699fde0b11e52d7af81ebf215c5532e1"

    expectedState:
      bookPendingRewards:
        "0x1000000000000000000000000000000000000001": "500"
        "0x1000000000000000000000000000000000000002": "500"
        "0x1000000000000000000000000000000000000003": "0"
        "0x1000000000000000000000000000000000000004": "0"
      bookStakedAmounts:
        "0x1000000000000000000000000000000000000001": "200000000"
        "0x1000000000000000000000000000000000000002": "200000000"
        "0x1000000000000000000000000000000000000003": "100000000"
        "0x1000000000000000000000000000000000000004": "100000000"
      userBalance:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720": "9600003000"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955": "9800000000"
      userPendingRewards:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720":
          "0x1000000000000000000000000000000000000001": "0"
          "0x1000000000000000000000000000000000000002": "0"
          "0x1000000000000000000000000000000000000003": "0"
          "0x1000000000000000000000000000000000000004": "0"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955":
          "0x1000000000000000000000000000000000000001": "500"
          "0x1000000000000000000000000000000000000002": "500"
      userStakedAmounts:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720":
          "0x1000000000000000000000000000000000000001": "100000000"
          "0x1000000000000000000000000000000000000002": "100000000"
          "0x1000000000000000000000000000000000000003": "100000000"
          "0x1000000000000000000000000000000000000004": "100000000"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955":
          "0x1000000000000000000000000000000000000001": "100000000"
          "0x1000000000000000000000000000000000000002": "100000000"
          "0x1000000000000000000000000000000000000003": "0"
          "0x1000000000000000000000000000000000000004": "0"

  - name: "restakeRewardPosition"
    calls:
      - type: "restakeRewardPosition"
        tokenID: "1"
        account: "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955"

    expectedLogs:
      - eventName: "RewardClaimed"
        address: "0x227efaea699fde0b11e52d7af81ebf215c5532e1"
      - eventName: "Staked"
        address: "0x227efaea699fde0b11e52d7af81ebf215c5532e1"

    expectedState:
      bookPendingRewards:
        "0x1000000000000000000000000000000000000001": "500"
        "0x1000000000000000000000000000000000000002": "0"
        "0x1000000000000000000000000000000000000003": "0"
        "0x1000000000000000000000000000000000000004": "0"
      bookStakedAmounts:
        "0x1000000000000000000000000000000000000001": "200000000"
        # Should be wrong. The 500 restaked amount should be added to the stake.
        "0x1000000000000000000000000000000000000002": "200000000"
        "0x1000000000000000000000000000000000000003": "100000000"
        "0x1000000000000000000000000000000000000004": "100000000"
      userBalance:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720": "9600003000"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955": "9800000000"
      userPendingRewards:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720":
          "0x1000000000000000000000000000000000000001": "0"
          "0x1000000000000000000000000000000000000002": "0"
          "0x1000000000000000000000000000000000000003": "0"
          "0x1000000000000000000000000000000000000004": "0"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955":
          "0x1000000000000000000000000000000000000001": "500"
          "0x1000000000000000000000000000000000000002": "0"
      userStakedAmounts:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720":
          "0x1000000000000000000000000000000000000001": "100000000"
          "0x1000000000000000000000000000000000000002": "100000000"
          "0x1000000000000000000000000000000000000003": "100000000"
          "0x1000000000000000000000000000000000000004": "100000000"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955":
          "0x1000000000000000000000000000000000000001": "100000000"
          "0x1000000000000000000000000000000000000002": "100000500"
          "0x1000000000000000000000000000000000000003": "0"
          "0x1000000000000000000000000000000000000004": "0"

  - name: "transferStakePosition"
    calls:
      - type: "transferStakePosition"
        from: "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955"
        to: "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720"
        tokenID: "3"

    expectedLogs:
      - eventName: "Transfer"
        address: "0x75c986519a6f4a144520aad0aff7846d17e66175"

    expectedState:
      bookPendingRewards:
        "0x1000000000000000000000000000000000000001": "500"
        "0x1000000000000000000000000000000000000002": "0"
        "0x1000000000000000000000000000000000000003": "0"
        "0x1000000000000000000000000000000000000004": "0"
      bookStakedAmounts:
        "0x1000000000000000000000000000000000000001": "200000000"
        "0x1000000000000000000000000000000000000002": "200000000"
        "0x1000000000000000000000000000000000000003": "100000000"
        "0x1000000000000000000000000000000000000004": "100000000"
      userBalance:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720": "9600003000"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955": "9800000000"
      userPendingRewards:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720":
          "0x1000000000000000000000000000000000000001": "500"
          "0x1000000000000000000000000000000000000002": "0"
          "0x1000000000000000000000000000000000000003": "0"
          "0x1000000000000000000000000000000000000004": "0"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955":
          "0x1000000000000000000000000000000000000002": "0"
      userStakedAmounts:
        "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720":
          "0x1000000000000000000000000000000000000001": "200000000"
          "0x1000000000000000000000000000000000000002": "100000000"
          "0x1000000000000000000000000000000000000003": "100000000"
          "0x1000000000000000000000000000000000000004": "100000000"
        "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955":
          "0x1000000000000000000000000000000000000001": "0"
          "0x1000000000000000000000000000000000000002": "100000500"
          "0x1000000000000000000000000000000000000003": "0"
          "0x1000000000000000000000000000000000000004": "0"
